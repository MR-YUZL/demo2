<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>qfy-plugin</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      .qfy-btn-group {
        position: absolute;
        height: 156px;
        top: 0;
      }
      .qfy-btn-group > div {
        width: 50px;
        text-align: center;
        height: 50px;
        line-height: 50px;
        border: 1px solid #c4c7ce;
        border-top: none;
        cursor: pointer;
        position: relative;
        color: #333;
      }
      .qfy-btn-group > div:first-child {
        border-top: 1px solid #c4c7ce;
      }
      .tel-box:hover > .tel {
        display: block;
      }
      .tel {
        position: absolute;
        top: -1px;
        height: 50px;
        width: 150px;
        border: 1px solid #c4c7ce;
        display: none;
      }
      .tel > a {
        text-decoration: none;
        color: #333;
      }
      .wechat-box:hover > .wechat {
        display: block;
      }
      .wechat {
        position: absolute;
        bottom: -1px;
        height: 101px;
        width: 101px;
        border: 1px solid #c4c7ce;
        display: none;
        overflow: hidden;
      }
      .wechat.wechat2 {
        bottom: -51px;
      }
      .wechat > img {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div class="qfy-btn-group">
      <!-- <div class="zx-box">咨询</div>
      <div class="tel-box">
        <span class="tel-txt">电话</span>
        <div class="tel">
          <a id="tel" href="tel:057162983051">0571-62983051</a>
        </div>
      </div>
      <div class="wechat-box">
        <span class="wechat-txt">微信</span>
        <div class="wechat">
          <img id="wechat" src="" />
        </div>
      </div> -->
      <!-- built files will be auto injected -->
    </div>
  </body>
  <script>
    var urlParams = {};
    function getUrlParams() {
      var pairs = location.search.substring(1).split("&");
      for (var i = 0; i < pairs.length; i++) {
        var pos = pairs[i].indexOf("=");
        if (pos === -1) {
          continue;
        }
        urlParams[pairs[i].substring(0, pos)] = decodeURIComponent(
          pairs[i].substring(pos + 1)
        );
      }
    }

    function isTerminal() {
      var reg = /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i;
      if (navigator.userAgent.match(reg)) {
        return "mobile";
      } else {
        return "pc";
      }
    }

    window.onload = function() {
      getUrlParams();
      var position = urlParams["position"];
      var tel = urlParams["tel"];
      var teltxt = urlParams["teltxt"];
      var wechat = urlParams["wechat"];
      var wechattxt = urlParams["wechattxt"];
      var zx = urlParams["zx"];
      var tag = urlParams["tag"];
      console.log(position, tel, teltxt, wechat, wechattxt, zx, tag);
      var tags = tag.split(",");
      var container = document.getElementsByClassName("qfy-btn-group")[0];
      if (position === "1" || position === "2" || position === "3") {
        container.style.right = "0";
      } else {
        container.style.left = "0";
      }
      for (var i = 0; i < tags.length; i++) {
        if (tags[i] === "1" && zx) {
          container.innerHTML += '<div class="zx-box" id="myBtn">咨询</div>';
        }

        if (tags[i] === "2" && tel && teltxt) {
          if (position === "1" || position === "2" || position === "3") {
            container.innerHTML += `<div class="tel-box"><span class="tel-txt">${teltxt}</span><div class="tel" style="left:-152px;"><a id="tel" href="tel:${tel}">${tel}</a></div></div>`;
          } else {
            container.innerHTML += `<div class="tel-box"><span class="tel-txt">${teltxt}</span><div class="tel" style="left:50px;"><a id="tel" href="tel:${tel}">${tel}</a></div></div>`;
          }
        }

        if (tags[i] === "3" && wechat && wechattxt) {
          if (position === "1" || position === "2" || position === "3") {
            container.innerHTML += `<div class="wechat-box"><span class="wechat-txt">${wechattxt}</span><div class="wechat ${
              i == 0 ? "wechat2" : ""
            }" style="left:-103px;"><img id="wechat" src="${wechat}" /></div></div>`;
          } else {
            container.innerHTML += `<div class="wechat-box"><span class="wechat-txt">${wechattxt}</span><div class="wechat ${
              i == 0 ? "wechat2" : ""
            }" style="left:50px;"><img id="wechat" src="${wechat}" /></div></div>`;
          }
        }
      }
      document.getElementById("myBtn").addEventListener("click", function() {
        window.open(
          window.location.host + "/#/conversation?url=" + location.host,
          "_blank"
        );
      });
      document.getElementById("tel").addEventListener("click", function() {
        if (isTerminal() === "pc") {
          jsonp(
            "http://127.0.0.1:3366/callout?phone=" +
              tel +
              "&callback=cb_callout",
            null,
            () => {}
          );
        }
      });
    };
  </script>
</html>
